<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edge.stocks.product.ck.dao.Pro_CK_StockDao">
	<!-- 定义缓存 一般是一级缓存，如果用同一个sqlsession 那么相同查询直接会从缓存中查找 <cache size="1024" flushInterval="60000" 
		eviction="LRU" readOnly="false"></cache> -->

	<!--分页显示出库的库存 -->
	<select id="pro_CK_StockList" parameterType="ERP_ProStock_QueryVo" resultType="ERP_Product_Stock">
		select * from (select row_.*, rownum rownum_ from (select * from
		erp_product_Stock order by stock_Id desc ) row_
		<where>
			rownum &lt;= #{rows} and cknumber!=0
		</where>
		)
		<where>
			rownum_ &gt;= #{page}
		</where>
	</select>

	<!--查询出库库存总数量 -->
	<select id="pro_CK_StockCount" resultType="Integer" parameterType="ERP_ProStock_QueryVo">
		select count(1) from erp_product_Stock 
	</select>
	
	<!--加载所有未出库的库存  -->
	<select id="allWckProductStock" resultType="ERP_Product_Stock">
		<!-- select s.* from erp_product_Stock s
		left join erp_products p on s.product=p.product_id
		<where>
		 p.is_ck=0 and (nvl(s.rknumber,0)-nvl(s.cknumber,0))!=0
		</where> -->
		select s.* from erp_product_Stock s
			  		left join erp_products p
			    	on s.product = p.product_id
			 <where> p.is_rk = 1
			   and (p.is_allrk = 0 or p.is_allrk = 1)
			   and (p.is_ck = 0 or p.is_ck = 1)
			   and p.is_allck = 0
			 </where>
	</select>
	
	<!--加载某一库存下已出库的成品并获得成品数量  -->
	<select id="yckCount" parameterType="Integer" resultType="Integer">
		select count(1) from erp_stocks_Record
		<where>
			stock=#{stock_Id} and record_Type=1
		</where>
	</select>
	
	<!--加载当前成品的总出库数量  -->
	<select id="totalYckCount" parameterType="Integer" resultType="Integer">
		select count(1) from erp_stocks_Record
		<where>
			product=#{product} and record_Type=1
		</where>
	</select>
	
</mapper>